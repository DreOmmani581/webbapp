sudo: required

services:
  - docker 

script:
  - cd webapp/
  - docker-compose build 

after_success:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_ID" --password-stdin


  - docker tag celeryworker dreommani/celeryworker
  - docker push dreommani/celeryworker

  - docker tag traefik dreommani/traefik
  - docker push dreommani/traefik

  - docker tag postgres dreommani/postgres
  - docker push dreommani/postgres

  - docker tag dpage/pgadmin4 dreommani/dpage/pgadmin4
  - docker push dreommani/dpage/pgadmin4

  - docker tag rabbitmq dreommani/rabbitmq
  - docker push dreommani/rabbitmq

  - docker tag mher/flower dreommani/mher/flower
  - docker push dreommani/mher/flower

  - docker tag frontend dreommani/frontend
  - docker push dreommani/frontend

  - docker tag pgadmin4 dreommani/pgadmin4
  - docker push dreommani/pgadmin4

deploy:
  provider : elasticbeanstalk
  region: us-east-1
  app: Webapp
  env: Webapp-env
  bucket_name: elasticbeanstalk-us-east-1-434405741460
  bucket_path: Webapp
  on : 
       branch: main
  acces_key_id: $AWS_ACCESS_KEY
  secret_acces_key: $AWS_SECRET_KEY